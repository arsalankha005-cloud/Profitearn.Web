<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dashboard — VIP Plans</title>
<style>
  :root{
    --bg:#071923;
    --card:#0f2630;
    --accent:#13b66d;
    --accent-strong:#0e8f4d;
    --muted:#9fb3ad;
    --glass: rgba(255,255,255,0.03);
    --card-shadow: 0 18px 40px rgba(3,12,15,0.7);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: "Segoe UI", Roboto, "Noto Nastaliq Urdu", Arial, sans-serif;
    background: linear-gradient(180deg,#071923 0%, #041319 100%);
    color:#eaf7ef;
    -webkit-font-smoothing:antialiased;
  }

  header{
    position:sticky; top:0; z-index:40;
    background:transparent;
    padding:18px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    border-bottom: 1px solid rgba(255,255,255,0.03);
    backdrop-filter: blur(4px);
  }
  header h1{margin:0; font-size:22px; color:var(--accent); font-weight:800; text-align:center; width:100%;}
  .balance-btn{
    background:#00140b;
    color: #9ff6b8;
    border:2px solid #0ff77f;
    padding:8px 14px;
    border-radius:12px;
    font-weight:700;
    position:absolute;
    left:18px;
    top:14px;
  }

  nav{
    display:flex;
    gap:12px;
    padding:14px 18px;
    justify-content:center;
    flex-wrap:wrap;
  }
  nav button{
    border:none;
    padding:10px 18px;
    border-radius:10px;
    background:var(--accent);
    color:#00210a;
    font-weight:800;
    cursor:pointer;
    box-shadow:0 8px 20px rgba(0,0,0,0.6);
  }
  nav button.secondary{background:#15c2ff; color:#002;}

  main{padding:18px; max-width:980px; margin:0 auto 60px;}

  /* TOP heading */
  .top-title{ text-align:center; margin-top:6px; }
  .top-title h2{ color:var(--accent); margin:0; font-size:28px; }
  .top-title p{ color:var(--muted); margin:6px 0 0 0; }

  /* Plans style - big VIP boxes like image */
  .plans-wrap{ margin-top:20px; display:flex; flex-direction:column; gap:22px; }
  .plan-card{
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.14));
    border-radius:18px;
    padding:22px;
    box-shadow: var(--card-shadow);
    border:1px solid rgba(0,0,0,0.45);
    overflow:hidden;
    display:flex;
    gap:18px;
    align-items:flex-start;
  }
  .plan-left{ flex:0 0 160px; display:flex; flex-direction:column; gap:6px; align-items:center; }
  .vip-badge{ background:transparent; color:var(--accent); font-weight:900; font-size:20px; }
  .price-box{ background:rgba(0,0,0,0.25); border-radius:12px; padding:10px 12px; text-align:center; border:1px solid rgba(0,0,0,0.5); }
  .price-box .price{ font-weight:900; font-size:18px; color:#fff; }
  .price-box .daily{ font-size:13px; color:var(--muted); margin-top:6px; }

  .plan-body{ flex:1; padding-right:10px; }
  .plan-title{ color:var(--accent); font-weight:900; font-size:22px; margin:0 0 8px 0; }
  .plan-detail{ color:#cfeee0; margin:8px 0; font-size:15px; line-height:1.6; }
  .detail-row{ display:flex; justify-content:space-between; gap:12px; align-items:center; margin:8px 0; }
  .detail-label{ color:var(--muted); }
  .buy-btn{ margin-top:12px; background:var(--accent); color:#00210a; padding:10px 16px; border-radius:12px; border:none; font-weight:900; cursor:pointer; box-shadow:0 8px 20px rgba(0,0,0,0.45); }

  /* Deposit / Withdraw / Referral cards */
  .card{background:var(--card); border-radius:12px; padding:18px; box-shadow:0 8px 24px rgba(0,0,0,0.55); border:1px solid rgba(0,0,0,0.45); margin-top:12px;}
  label{display:block; font-size:13px; color:var(--muted); margin-bottom:6px; text-align:right;}
  input[type="text"], input[type="number"], input[type="password"], select{
    width:100%;
    padding:10px 12px;
    border-radius:8px;
    border:1px solid rgba(0,0,0,0.5);
    background:#071a16;
    color:#eaf8ee;
    outline:none;
    margin-bottom:10px;
    text-align:right;
  }
  .submit{background:var(--accent); border:none; color:#022; padding:10px 14px; font-weight:800; border-radius:10px; cursor:pointer;}
  .submit.danger{background:#ff5c5c; color:#fff}
  .payboxes{display:flex; gap:12px; margin-bottom:12px; flex-wrap:wrap; justify-content:space-between;}
  .paybox{flex:1 1 48%; background:var(--glass); padding:14px; border-radius:10px; border:1px solid rgba(0,0,0,0.4); text-align:center;}
  .paybox strong{display:block; color:var(--accent); font-size:16px; margin-bottom:6px;}
  .paybox small{display:block; color:var(--muted); font-size:13px;}

  .pending-list{margin-top:12px; display:flex; flex-direction:column; gap:8px;}
  .pending-item{background:rgba(255,255,255,0.02); padding:10px; border-radius:8px; display:flex; justify-content:space-between; align-items:center;}
  .badge{background:#091; color:#023; padding:6px 10px; border-radius:8px; font-weight:800; color:var(--accent);}

  .ref-box{display:flex; gap:10px; align-items:center; margin-top:10px; flex-wrap:wrap; justify-content:space-between;}
  .ref-input{flex:1 1 300px; padding:10px; border-radius:8px; border:1px solid rgba(0,0,0,0.4); background:#071a16; color:#eafff0; text-align:left;}
  .copy-btn{background:#15c2ff; border:none; padding:10px 12px; border-radius:8px; cursor:pointer; font-weight:800; color:#022}

  footer{padding:30px 0 60px; text-align:center; color:var(--muted)}
  @media (max-width:900px){
    .plan-card{flex-direction:column; align-items:stretch;}
    .plan-left{flex:0 0 auto; flex-direction:row; justify-content:space-between;}
    .ref-input{width:100%;}
  }

  /* small helpers */
  .muted{color:var(--muted)}
  .center{text-align:center}
</style>
</head>
<body>

<header>
  <button class="balance-btn" id="balanceBtn">Balance: Rs <span id="balance">0</span></button>
  <h1>Dashboard</h1>
</header>

<nav style="direction:ltr;">
  <button onclick="showPage('home')">Home</button>
  <button onclick="showPage('deposit')">Deposit</button>
  <button onclick="showPage('withdraw')">Withdraw</button>
  <button onclick="showPage('referral')">Referral</button>
</nav>

<main>

  <div class="top-title center">
    <h2>All Available VIP Plans (30 Days)</h2>
    <p class="muted">بڑے VIP-style پلان باکسز — ہر پلان کے نیچے Buy Now</p>
  </div>

  <!-- HOME / PLANS -->
  <section id="home" class="page" style="display:block; margin-top:18px;">
    <div class="plans-wrap" id="plansWrap">
      <!-- JS will inject plan cards here -->
    </div>
  </section>

  <!-- DEPOSIT -->
  <section id="deposit" class="page" style="display:none;">
    <h3 class="center" style="color:var(--accent)">Deposit Funds</h3>
    <div class="card">
      <div class="payboxes" style="direction:rtl">
        <div class="paybox">
          <strong>JazzCash</strong>
          <small>03218684114</small>
          <small class="muted">رقم بھیجیں اور Transaction ID فارم میں درج کریں</small>
        </div>
        <div class="paybox">
          <strong>EasyPaisa</strong>
          <small>03706502150</small>
          <small class="muted">رقم بھیجیں اور Transaction ID فارم میں درج کریں</small>
        </div>
      </div>

      <label>منتخب کریں (Payment Method)</label>
      <select id="depositMethod" style="direction:rtl">
        <option value="jazzcash">JazzCash</option>
        <option value="easypaisa">EasyPaisa</option>
      </select>

      <label>آپ کا نام</label>
      <input type="text" id="depositName" placeholder="اپنا نام درج کریں">

      <label>Amount (Rs)</label>
      <input type="number" id="depositAmount" placeholder="مثلاً 1500">

      <label>Transaction ID</label>
      <input type="text" id="depositTrx" placeholder="Payment Transaction ID">

      <label>PIN (Use: 7890)</label>
      <input type="password" id="depositPin" placeholder="PIN درج کریں">

      <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:8px;">
        <button class="submit" onclick="submitDeposit()">Submit Deposit</button>
      </div>

      <div id="depositHistory" style="margin-top:14px; color:var(--muted); font-size:13px"></div>
    </div>
  </section>

  <!-- WITHDRAW -->
  <section id="withdraw" class="page" style="display:none;">
    <h3 class="center" style="color:var(--accent)">Withdraw Funds</h3>
    <div class="card">
      <label>Method</label>
      <select id="withdrawMethod" style="direction:rtl">
        <option value="jazzcash">JazzCash</option>
        <option value="easypaisa">EasyPaisa</option>
      </select>

      <label>Number</label>
      <input type="text" id="withdrawNumber" placeholder="JazzCash / EasyPaisa number">

      <label>Amount (Rs)</label>
      <input type="number" id="withdrawAmount" placeholder="Amount to withdraw">

      <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:8px;">
        <button class="submit" onclick="submitWithdraw()">Submit Withdraw</button>
      </div>

      <div style="margin-top:16px;">
        <h4 class="muted">Pending Withdrawals</h4>
        <div class="pending-list" id="pendingList"></div>
      </div>
    </div>
  </section>

  <!-- REFERRAL -->
  <section id="referral" class="page" style="display:none;">
    <h3 class="center" style="color:var(--accent)">Referral Program</h3>
    <div class="card">
      <p class="muted"><strong>Level 1:</strong> 10% &nbsp;&nbsp; <strong>Level 2:</strong> 4% &nbsp;&nbsp; <strong>Level 3:</strong> 1%</p>

      <div class="ref-box" style="direction:ltr">
        <input id="refLink" class="ref-input" readonly />
        <button class="copy-btn" onclick="copyReferral()">Copy Link</button>
      </div>

      <div style="margin-top:12px; color:var(--muted)">
        <p>ہر یوزر کو ایک منفرد ریفرل لنک ملے گا۔ جتنے زیادہ لوگ آپ کے لنک سے آئیں گے آپ کو اتنا کمیشن ملے گا۔</p>
      </div>
    </div>
  </section>

  <footer style="margin-top:20px; text-align:center; color:var(--muted)">
    © Investment Dashboard — Green & Dark Theme — Demo
  </footer>

</main>

<script>
/* ===========================
   APPLICATION STATE & UTILS
   =========================== */
const PIN = "7890";
const ONE_HOUR_MS = 3600000;

let state = {
  balance: 0,
  deposits: [],       // {id, method, name, amount, trx, at}
  pendingWithdraws: [], // {id, method, number, amount, requestedAt, status}
  userId: null
};

const PLANS = [
  { id:1, title:"VIP 1", price:350, daily:55 },
  { id:2, title:"VIP 2", price:720, daily:110 },
  { id:3, title:"VIP 3", price:1500, daily:220 },
  { id:4, title:"VIP 4", price:4000, daily:440 },
  { id:5, title:"VIP 5", price:9000, daily:990 },
  { id:6, title:"VIP 6", price:15000, daily:1760 }
];

const timers = new Map(); // withdrawId -> timeoutId

function saveState(){
  localStorage.setItem('inv_state_v1', JSON.stringify({
    balance: state.balance,
    deposits: state.deposits,
    pendingWithdraws: state.pendingWithdraws,
    userId: state.userId
  }));
}
function loadState(){
  const raw = localStorage.getItem('inv_state_v1');
  if(raw){
    try{
      const s = JSON.parse(raw);
      state.balance = s.balance || 0;
      state.deposits = s.deposits || [];
      state.pendingWithdraws = s.pendingWithdraws || [];
      state.userId = s.userId || null;
    }catch(e){
      console.error("load error", e);
    }
  }
  if(!state.userId){
    state.userId = 'USER' + Math.floor(100000 + Math.random()*900000);
  }
  saveState();
}

/* ================
   UI Render Helpers
   ================ */
function updateBalanceUI(){
  document.getElementById('balance').innerText = Number(state.balance).toFixed(0);
}

function showPage(id){
  document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
  document.getElementById(id).style.display = 'block';
  if(id === 'deposit') {
    // scroll to top of deposit for visibility
    window.scrollTo({top:0, behavior:'smooth'});
  }
}

/* ================
   Render Plans
   ================ */
function renderPlans(){
  const wrap = document.getElementById('plansWrap');
  wrap.innerHTML = '';
  PLANS.forEach((p, idx) => {
    const total = p.daily * 30;
    const card = document.createElement('div');
    card.className = 'plan-card';
    card.innerHTML = `
      <div class="plan-left">
        <div class="vip-badge">${p.title}</div>
        <div class="price-box">
          <div class="price">Rs ${p.price.toLocaleString()}</div>
          <div class="daily">Daily: Rs ${p.daily}</div>
        </div>
      </div>
      <div class="plan-body">
        <div class="plan-title">${p.title}</div>
        <div class="plan-detail">
          <div class="detail-row"><div class="detail-label">Price:</div><div>Rs ${p.price.toLocaleString()}</div></div>
          <div class="detail-row"><div class="detail-label">Daily Profit:</div><div>Rs ${p.daily}</div></div>
          <div class="detail-row"><div class="detail-label">Total Profit:</div><div>Rs ${total.toLocaleString()}</div></div>
          <div class="detail-row"><div class="detail-label">Duration:</div><div>30 Days</div></div>
          <div class="detail-row"><div class="detail-label">Daily Tasks:</div><div>2 TikTok Videos</div></div>
        </div>
        <div style="text-align:left;">
          <button class="buy-btn" data-plan="${p.id}" onclick="buyNow(${p.id})">Buy Now</button>
        </div>
      </div>
    `;
    wrap.appendChild(card);
  });
}

/* ================
   Buy Now -> Prefill Deposit
   ================ */
function buyNow(planId){
  const plan = PLANS.find(pl => pl.id === planId);
  if(!plan) return;
  // prefill deposit amount with plan price and set a small note in name field
  document.getElementById('depositAmount').value = plan.price;
  document.getElementById('depositName').value = state.userId + ' - ' + plan.title;
  showPage('deposit');
  // focus trx field
  setTimeout(()=> document.getElementById('depositTrx').focus(), 250);
}

/* ================
   Deposit
   ================ */
function renderDepositHistory(){
  const el = document.getElementById('depositHistory');
  if(!el) return;
  if(state.deposits.length === 0){
    el.innerHTML = '<div class="muted">کوئی ڈپازٹ ریکارڈ نہیں۔</div>';
    return;
  }
  el.innerHTML = '<strong>Recent Deposits:</strong><br/>' + state.deposits.slice(-6).reverse().map(d=>{
    const t = new Date(d.at).toLocaleString();
    return `${d.method.toUpperCase()} • Rs ${d.amount} • ${d.trx} • ${t}`;
  }).join('<br/>');
}

function submitDeposit(){
  const method = document.getElementById('depositMethod').value;
  const name = document.getElementById('depositName').value.trim();
  const amount = Number(document.getElementById('depositAmount').value);
  const trx = document.getElementById('depositTrx').value.trim();
  const pin = document.getElementById('depositPin').value.trim();

  if(!name){ alert('براہ کرم اپنا نام درج کریں'); return; }
  if(!amount || amount <= 0){ alert('درست رقم درج کریں'); return; }
  if(!trx){ alert('Transaction ID درج کریں'); return; }
  if(pin !== PIN){ alert('غلط PIN'); return; }

  const dep = { id: 'D' + Date.now(), method, name, amount, trx, at: Date.now() };
  state.deposits.push(dep);
  state.balance = Number(state.balance) + Number(amount);
  saveState();
  updateBalanceUI();
  renderDepositHistory();

  // clear trx & pin (keep name for convenience)
  document.getElementById('depositTrx').value = '';
  document.getElementById('depositPin').value = '';

  alert('Deposit successful — your balance updated.');
}

/* ================
   Withdraw
   ================ */
function renderPendingList(){
  const list = document.getElementById('pendingList');
  if(!list) return;
  list.innerHTML = '';
  if(state.pendingWithdraws.length === 0){
    list.innerHTML = '<div class="muted">کوئی pending withdraws نہیں۔</div>';
    return;
  }
  state.pendingWithdraws.slice().reverse().forEach(p=>{
    const div = document.createElement('div');
    div.className = 'pending-item';
    const left = document.createElement('div');
    left.innerHTML = `<div style="font-weight:800">Rs ${p.amount}</div><div class="muted" style="font-size:13px">${p.method.toUpperCase()} • ${p.number}</div>`;
    const right = document.createElement('div');
    if(p.status === 'pending'){
      const cancelBtn = document.createElement('button');
      cancelBtn.className = 'submit danger';
      cancelBtn.style.background = '#ff6b6b';
      cancelBtn.style.color = '#fff';
      cancelBtn.style.marginLeft = '10px';
      cancelBtn.innerText = 'Cancel';
      cancelBtn.onclick = ()=> cancelWithdraw(p.id);
      right.appendChild(cancelBtn);
      const badge = document.createElement('span');
      badge.className = 'badge';
      badge.innerText = 'Pending';
      right.appendChild(badge);
    } else if(p.status === 'cancelled'){
      const badge = document.createElement('span');
      badge.className = 'badge';
      badge.innerText = 'Cancelled';
      right.appendChild(badge);
    } else {
      const badge = document.createElement('span');
      badge.className = 'badge';
      badge.innerText = 'Processed';
      right.appendChild(badge);
    }
    div.appendChild(left);
    div.appendChild(right);
    list.appendChild(div);
  });
}

function submitWithdraw(){
  const method = document.getElementById('withdrawMethod').value;
  const number = document.getElementById('withdrawNumber').value.trim();
  const amount = Number(document.getElementById('withdrawAmount').value);

  if(!number){ alert('براہ کرم نمبر درج کریں'); return; }
  if(!amount || amount <= 0){ alert('درست رقم درج کریں'); return; }
  if(amount > state.balance){ alert('Insufficient balance'); return; }

  const id = 'W' + Date.now();
  const entry = { id, method, number, amount, requestedAt: Date.now(), status: 'pending' };
  state.pendingWithdraws.push(entry);
  state.balance = Number(state.balance) - Number(amount);
  saveState();
  updateBalanceUI();
  renderPendingList();
  setAutoCancel(entry);

  // clear form
  document.getElementById('withdrawNumber').value = '';
  document.getElementById('withdrawAmount').value = '';

  alert('Withdraw submitted and now Pending. If not processed within 1 hour it will be returned automatically.');
}

function cancelWithdraw(id){
  const idx = state.pendingWithdraws.findIndex(p=>p.id===id);
  if(idx === -1) return;
  const w = state.pendingWithdraws[idx];
  if(w.status !== 'pending') return;
  // clear timer if exists
  if(timers.has(id)){ clearTimeout(timers.get(id)); timers.delete(id); }
  w.status = 'cancelled';
  state.balance = Number(state.balance) + Number(w.amount);
  saveState();
  updateBalanceUI();
  renderPendingList();
  alert('Withdraw cancelled and amount returned to balance.');
}

function setAutoCancel(entry){
  // compute remaining ms in case loaded from storage with elapsed time
  const elapsed = Date.now() - entry.requestedAt;
  const remaining = Math.max(0, ONE_HOUR_MS - elapsed);
  if(remaining <= 0){
    // immediate cancel
    autoCancel(entry.id);
    return;
  }
  const tid = setTimeout(()=> autoCancel(entry.id), remaining);
  timers.set(entry.id, tid);
}

function autoCancel(id){
  const idx = state.pendingWithdraws.findIndex(p=>p.id===id);
  if(idx === -1) return;
  const w = state.pendingWithdraws[idx];
  if(w.status !== 'pending') return;
  w.status = 'cancelled';
  state.balance = Number(state.balance) + Number(w.amount);
  // clear timer handle
  if(timers.has(id)){ clearTimeout(timers.get(id)); timers.delete(id); }
  saveState();
  updateBalanceUI();
  renderPendingList();
  // no alert to avoid noisy behavior, but you can enable it
  // alert('A pending withdraw was not processed and has been returned to your balance.');
}

/* ================
   Referral
   ================ */
function setupReferral(){
  const link = `${location.origin}${location.pathname}#ref?uid=${state.userId}`;
  document.getElementById('refLink').value = link;
}

function copyReferral(){
  const inp = document.getElementById('refLink');
  inp.select();
  inp.setSelectionRange(0, 99999);
  document.execCommand('copy');
  alert('Referral link copied.');
}

/* ================
   Init
   ================ */
function init(){
  loadState();
  updateBalanceUI();
  renderPlans();
  renderDepositHistory();
  renderPendingList();
  setupReferral();
  // restore timers for pending withdraws
  state.pendingWithdraws.forEach(w=>{
    if(w.status === 'pending'){
      setAutoCancel(w);
    }
  });

  // handle fragment navigation (optional)
  const hash = location.hash.replace('#','');
  if(hash.startsWith('ref?')) showPage('referral');
}
window.addEventListener('load', init);

/* Expose some functions for buttons */
window.showPage = showPage;
window.buyNow = buyNow;
window.submitDeposit = submitDeposit;
window.submitWithdraw = submitWithdraw;
window.copyReferral = copyReferral;

</script>
</body>
</html>
