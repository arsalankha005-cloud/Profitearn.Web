<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Investment Dashboard - User</title>
<style>
  :root{--bg:#071923;--card:#0f2630;--accent:#13b66d;--muted:#9fb3ad}
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,Arial;background:linear-gradient(180deg,#071923,#041319);color:#eaf7ef}
  header{padding:14px 18px;display:flex;align-items:center;justify-content:space-between}
  h1{margin:0;color:var(--accent)}
  .balance{background:#00140b;color:#9ff6b8;border:2px solid #0ff77f;padding:8px 12px;border-radius:10px;font-weight:700}
  nav{display:flex;gap:10px;justify-content:center;padding:12px;background:transparent}
  nav button{background:var(--accent);border:none;padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:700}
  main{max-width:980px;margin:18px auto;padding:0 12px}
  .plans{display:flex;flex-direction:column;gap:18px}
  .plan{background:linear-gradient(180deg,rgba(255,255,255,0.01),rgba(0,0,0,0.12));border:1px solid rgba(0,0,0,0.45);border-radius:14px;padding:20px;display:flex;gap:18px;box-shadow:0 18px 40px rgba(3,12,15,0.7)}
  .plan-left{width:150px;text-align:center}
  .price{font-weight:900;font-size:20px;color:#fff}
  .daily{color:var(--muted);margin-top:6px}
  .plan-body{flex:1}
  .plan-title{color:var(--accent);font-weight:900;font-size:20px;margin:0 0 6px}
  .plan-row{display:flex;justify-content:space-between;color:#cfeee0;margin:6px 0}
  .buy{background:var(--accent);border:none;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:900;color:#022}
  .card{background:var(--card);padding:16px;border-radius:12px;border:1px solid rgba(0,0,0,0.45)}
  label{display:block;color:var(--muted);margin:8px 0 6px;text-align:left}
  input,select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(0,0,0,0.45);background:#071a16;color:#eaf8ee}
  .submit{background:var(--accent);border:none;padding:10px 14px;border-radius:8px;cursor:pointer;color:#022;font-weight:800;margin-top:8px}
  .muted{color:var(--muted)}
  .pending-list{margin-top:12px;display:flex;flex-direction:column;gap:8px}
  .pending-item{background:rgba(255,255,255,0.02);padding:10px;border-radius:8px;display:flex;justify-content:space-between;align-items:center}
  footer{text-align:center;color:var(--muted);margin:30px 0}
  @media(max-width:800px){.plan{flex-direction:column}.plan-left{width:100%}}
</style>
</head>
<body>
<header>
  <h1>Investment Dashboard</h1>
  <div class="balance">Balance: Rs <span id="balance">0</span></div>
</header>

<nav>
  <button onclick="show('home')">Home</button>
  <button onclick="show('deposit')">Deposit</button>
  <button onclick="show('withdraw')">Withdraw</button>
  <button onclick="show('referral')">Referral</button>
</nav>

<main>
  <!-- HOME -->
  <section id="home" class="page">
    <h2 style="color:var(--accent)">VIP Plans (30 days)</h2>
    <p class="muted">Large professional plan cards — click Buy Now to prefill deposit.</p>
    <div class="plans" id="plans"></div>
  </section>

  <!-- DEPOSIT -->
  <section id="deposit" class="page" style="display:none">
    <h2 style="color:var(--accent)">Deposit</h2>
    <div class="card">
      <div style="display:flex;gap:12px;flex-wrap:wrap">
        <div style="flex:1;min-width:200px">
          <strong>JazzCash</strong><div class="muted">03218684114</div>
        </div>
        <div style="flex:1;min-width:200px">
          <strong>EasyPaisa</strong><div class="muted">03706502150</div>
        </div>
      </div>

      <label>Payment Method</label>
      <select id="d_method">
        <option value="jazzcash">JazzCash</option>
        <option value="easypaisa">EasyPaisa</option>
      </select>

      <label>Your Name</label>
      <input id="d_name" type="text" placeholder="Full name">

      <label>Amount (PKR)</label>
      <input id="d_amount" type="number" placeholder="e.g. 1500">

      <label>Transaction ID</label>
      <input id="d_trx" type="text" placeholder="Transaction ID from payment">

      <label>PIN (use 7890)</label>
      <input id="d_pin" type="password" placeholder="PIN">

      <button class="submit" onclick="submitDeposit()">Submit Deposit Request</button>

      <div id="deposit_history" class="muted" style="margin-top:12px"></div>
    </div>
  </section>

  <!-- WITHDRAW -->
  <section id="withdraw" class="page" style="display:none">
    <h2 style="color:var(--accent)">Withdraw</h2>
    <div class="card">
      <label>Method</label>
      <select id="w_method"><option value="jazzcash">JazzCash</option><option value="easypaisa">EasyPaisa</option></select>
      <label>Number</label>
      <input id="w_number" type="text" placeholder="Payout number">
      <label>Amount (PKR)</label>
      <input id="w_amount" type="number" placeholder="Amount to withdraw">
      <button class="submit" onclick="submitWithdraw()">Submit Withdraw Request</button>

      <h4 class="muted" style="margin-top:12px">Pending Withdraws</h4>
      <div id="pending_withdraws" class="pending-list"></div>
    </div>
  </section>

  <!-- REFERRAL -->
  <section id="referral" class="page" style="display:none">
    <h2 style="color:var(--accent)">Referral</h2>
    <div class="card">
      <p class="muted"><strong>Level 1:</strong> 10% &nbsp; <strong>Level 2:</strong> 4% &nbsp; <strong>Level 3:</strong> 1%</p>
      <label>Your referral link (copy)</label>
      <input id="ref_link" readonly />
      <button class="submit" onclick="copyRef()">Copy Link</button>
      <div class="muted" style="margin-top:8px">Referral commissions shown in admin when paid — demo uses localStorage.</div>
    </div>
  </section>

  <footer>© Demo — Keep both files in same folder for admin/user sync</footer>
</main>

<script>
/* STORAGE KEYS & UTIL */
const KEY_DEPOSITS = 'inv_deposits_v2';     // list of deposit request objects
const KEY_WITHDRAWS = 'inv_withdraws_v2';   // list of withdraw request objects
const KEY_BALANCES = 'inv_balances_v2';     // map userId => balance
const KEY_USERID = 'inv_userid_v2';

const PLANS = [
  {id:1,name:'VIP 1',price:350,daily:55},
  {id:2,name:'VIP 2',price:720,daily:110},
  {id:3,name:'VIP 3',price:1500,daily:220},
  {id:4,name:'VIP 4',price:4000,daily:440},
  {id:5,name:'VIP 5',price:9000,daily:990},
  {id:6,name:'VIP 6',price:15000,daily:1760}
];

function storageGet(k,def){ try{ const v=localStorage.getItem(k); return v?JSON.parse(v):def; }catch(e){return def;} }
function storageSet(k,obj){ localStorage.setItem(k,JSON.stringify(obj)); }

/* USER IDENTIFIER & BALANCE */
let userId = storageGet(KEY_USERID,null);
if(!userId){ userId = 'U'+Math.floor(100000+Math.random()*900000); storageSet(KEY_USERID,userId); }
let balances = storageGet(KEY_BALANCES,{});
if(!(userId in balances)) balances[userId]=0;
storageSet(KEY_BALANCES,balances);

/* UI helpers */
function show(page){
  document.querySelectorAll('.page').forEach(s=>s.style.display='none');
  document.getElementById(page).style.display='block';
}
function updateBalanceUI(){ balances = storageGet(KEY_BALANCES,{}); const b = balances[userId]||0; document.getElementById('balance').innerText = Number(b).toFixed(0); }

/* RENDER PLANS */
function renderPlans(){
  const wrap = document.getElementById('plans');
  wrap.innerHTML = '';
  PLANS.forEach(p=>{
    const total = p.daily*30;
    const div = document.createElement('div');
    div.className='plan';
    div.innerHTML = `
      <div style="display:flex;gap:18px;align-items:center">
        <div class="plan-left">
          <div class="price">Rs ${p.price.toLocaleString()}</div>
          <div class="daily">Daily: Rs ${p.daily}</div>
        </div>
        <div class="plan-body">
          <div class="plan-title">${p.name}</div>
          <div class="plan-row"><div>Price</div><div>Rs ${p.price.toLocaleString()}</div></div>
          <div class="plan-row"><div>Daily Profit</div><div>Rs ${p.daily}</div></div>
          <div class="plan-row"><div>Total Profit</div><div>Rs ${total.toLocaleString()}</div></div>
          <div class="plan-row"><div>Duration</div><div>30 Days</div></div>
          <div style="margin-top:10px;text-align:left"><button class="buy" onclick="buyNow(${p.id})">Buy Now</button></div>
        </div>
      </div>
    `;
    wrap.appendChild(div);
  });
}

/* BUY NOW -> prefill deposit form and go to Deposit section */
function buyNow(planId){
  const plan = PLANS.find(p=>p.id===planId);
  if(!plan) return;
  document.getElementById('d_amount').value = plan.price;
  document.getElementById('d_name').value = userId + ' - ' + plan.name;
  show('deposit');
  setTimeout(()=>document.getElementById('d_trx').focus(),200);
}

/* DEPOSIT: create deposit request (does NOT auto-add balance) */
function submitDeposit(){
  const method = document.getElementById('d_method').value;
  const name = document.getElementById('d_name').value.trim();
  const amount = Number(document.getElementById('d_amount').value);
  const trx = document.getElementById('d_trx').value.trim();
  const pin = document.getElementById('d_pin').value.trim();
  if(!name || !amount || !trx){ alert('Please complete all fields.'); return; }
  if(pin !== '7890'){ alert('Incorrect PIN'); return; }

  const deposits = storageGet(KEY_DEPOSITS,[]);
  const obj = { id:'D'+Date.now(), userId, method, name, amount, trx, at:Date.now(), status:'pending' };
  deposits.push(obj); storageSet(KEY_DEPOSITS,deposits);
  document.getElementById('d_trx').value=''; document.getElementById('d_pin').value='';
  alert('Deposit request submitted. Admin will approve it to add balance.');
  renderDepositHistory();
}

/* RENDER deposit history (last items) */
function renderDepositHistory(){
  const deposits = storageGet(KEY_DEPOSITS,[]);
  const mine = deposits.filter(d=>d.userId===userId).slice(-6).reverse();
  const el = document.getElementById('deposit_history');
  if(mine.length===0) el.innerHTML='<div class="muted">No deposit records.</div>';
  else el.innerHTML = '<strong>Recent deposit requests:</strong><br/>' + mine.map(d=>`${d.method.toUpperCase()} • Rs ${d.amount} • ${d.trx} • ${new Date(d.at).toLocaleString()} • ${d.status}`).join('<br/>');
}

/* WITHDRAW: create withdraw request and deduct balance immediately (pending) */
function submitWithdraw(){
  const method = document.getElementById('w_method').value;
  const number = document.getElementById('w_number').value.trim();
  const amount = Number(document.getElementById('w_amount').value);
  balances = storageGet(KEY_BALANCES,{});
  const current = Number(balances[userId]||0);
  if(!number || !amount){ alert('Complete fields'); return; }
  if(amount > current){ alert('Insufficient balance'); return; }

  // deduct immediate and create pending record
  balances[userId] = current - amount;
  storageSet(KEY_BALANCES,balances);

  const withdraws = storageGet(KEY_WITHDRAWS,[]);
  const w = { id:'W'+Date.now(), userId, method, number, amount, requestedAt:Date.now(), status:'pending' };
  withdraws.push(w); storageSet(KEY_WITHDRAWS,withdraws);

  alert('Withdraw request submitted and is pending approval. If not processed within 1 hour it will be returned automatically.');
  document.getElementById('w_number').value=''; document.getElementById('w_amount').value='';
  updateBalanceUI(); renderPendingWithdraws();
}

/* pending withdraws UI (for this user) and auto-cancel check */
function renderPendingWithdraws(){
  const listEl = document.getElementById('pending_withdraws');
  const withdraws = storageGet(KEY_WITHDRAWS,[]).filter(w=>w.userId===userId).slice().reverse();
  if(withdraws.length===0){ listEl.innerHTML='<div class="muted">No pending withdraws.</div>'; return; }
  listEl.innerHTML = withdraws.map(w=>{
    const elapsed = Math.floor((Date.now()-w.requestedAt)/60000);
    return `<div class="pending-item"> <div>Rs ${w.amount} • ${w.method.toUpperCase()} • ${w.number}<div class="muted" style="font-size:12px">${new Date(w.requestedAt).toLocaleString()}</div></div><div><span class="muted">${w.status}</span><div class="muted" style="font-size:12px;text-align:right">${elapsed} min</div></div></div>`;
  }).join('');
}

/* AUTO-CANCEL withdraws older than 1 hour: run on load and periodically */
function autoCancelExpiredWithdraws(){
  const withdraws = storageGet(KEY_WITHDRAWS,[]);
  let changed=false; balances = storageGet(KEY_BALANCES,{});
  withdraws.forEach(w=>{
    if(w.status==='pending' && (Date.now()-w.requestedAt) > 3600000){
      // return amount
      balances[w.userId] = (balances[w.userId]||0) + Number(w.amount);
      w.status='cancelled';
      changed=true;
    }
  });
  if(changed){ storageSet(KEY_WITHDRAWS,withdraws); storageSet(KEY_BALANCES,balances); updateBalanceUI(); }
}

/* REFERRAL */
function initReferral(){
  const linkEl = document.getElementById('ref_link');
  const link = location.origin + location.pathname + '?ref=' + userId;
  linkEl.value = link;
}
function copyRef(){ const el=document.getElementById('ref_link'); el.select(); document.execCommand('copy'); alert('Referral link copied'); }

/* INIT */
function init(){
  renderPlans(); updateBalanceUI(); renderDepositHistory(); renderPendingWithdraws(); initReferral();
  autoCancelExpiredWithdraws();
  // periodic check every 30s
  setInterval(()=>{ renderPendingWithdraws(); autoCancelExpiredWithdraws(); updateBalanceUI(); },30000);
  // show home by default
  show('home');
}
window.addEventListener('load', init);
</script>
</body>
</html>
